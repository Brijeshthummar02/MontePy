variables:
  PYTHON_VER: "3.8"
  CONDA_BASE_NAME: experiment_analysis_montepy

.install:
  script:
    - if [[ -d dist ]]; then rm -r dist ; fi; 
    - if [[ `conda env list` == *"$CONDA_BASE_NAME-$PYTHON_VER"* ]]; then
    - else
    - conda create -n $CONDA_BASE_NAME-$PYTHON_VER -y python==$PYTHON_VER
    - fi
    - conda activate $CONDA_BASE_NAME-$PYTHON_VER
    - echo "Installing dependencies"
    - which python
    - which pip
    - pip uninstall -y montepy
    # install base requirements first
    - pip install -r requirements/common.txt
    # needed to build. Users shouldn't be doing this on their own.
    # Want to make sure it can be installed without dev stuff.
    - pip install build
    - python -m build --sdist --wheel
    - pip install . 
    - pip uninstall -y montepy
    - pip install --user dist/*.whl 
      # test the extras installation
    - pip install --user montepy[test]
    - pip install --user montepy[doc]
    - pip freeze
  artifacts:
    paths:
      - dist/
